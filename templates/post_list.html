{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- {% if user.is_authenticated %}
<a href="{% url 'blog:post_new' %}" class="btn btn-primary">Create New Post</a>
{% endif %} -->
<!-- <h2 style="color: black;">POSTS</h2><hr> --><br>
<h2 class="fw-bold text-center mb-4" style="color: #ffd700; font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;"> Latest Posts</h2>

<!-- category filter -->
<form method="get" class="mb-3">
    <div class="card shadow-sm p-3 mb-4">
        <div class="row g-3">
        <div class="col-md-4">
    <label for="category">Filter by category:</label>
    <select name="category" id="category" onchange="this.form.submit()">
        <option value="">--All Categories--</option>
        {% for category in categories %}
        <option value="{{ category.id }}"
         {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
            {{ category.name }}
        </option>
        {% endfor %}
    </select>
        </div>
<!-- <br> -->

<!-- tag filter -->
 <div class="col-md-4">
<label for="tag">Filter by Tag:  </label>      
   <select name="tag" id="tag" onchange="this.form.submit()">
        <option value="">   -- All Tags --</option>
        {% for tag in tags %}
            <option value="{{ tag.id }}" {% if request.GET.tag == tag.id|stringformat:"s" %}selected{% endif %}>
                {{ tag.name }}
            </option>
        {% endfor %}
</select>
        </div>

<!-- author filter-->
 <div class="col-md-4">
<label for="author">Filter by Author: </label>
<select name="author" id="author" onchange="this.form.submit()">
    <option value=""> --All Authors </option>
    {% for user in users %}
        <option value="{{user.id}}" {% if request.GET.author == user.id|stringformat:"s" %}selected{% endif %}>
            {{user.username }}
        </option>
        {% endfor %}
</select>
 </div>
        </div>
    </div>
   <!-- <button type="submit">Filter</button> -->
</form>
<hr>
    <!-- {% for post in posts %}
             <h2><a href="{% url 'blog:post_detail' pk=post.pk %}">{{ post.title }}</a></h2>
             <a href="{% url 'blog:post_detail' pk=post.pk %}"> 
             {% if post.image %}
             <img src="{{post.image.url}}" style="width: 300px; height: 300px;">
             {% endif %}</a>
             <br>
            <a style="text-decoration: none; color:black" href="{% url 'blog:post_detail' pk=post.pk %}"> 
             <p>{{ post.text|truncatewords:100 }}</p>
            </a>
             <br>
             <p><strong>Category:</strong>
            {% if post.category %}
            <span style="background: #eee; padding:2px 6px; border-radius:5px;">
            {{ post.category.name}}</span>
            {% else %}
             No Category
            {% endif %}
            </p>
 
             <p><strong>Tags:</strong>
            {% for tag in post.tags.all %}
            <span style="background: #eee; padding:2px 6px; border-radius:5px;">
            {{ tag.name }}</span>
            {% empty %}
              No Tags
              {% endfor %}
            </p>
            <a style="text-decoration:none; color: black" href="{% url 'api:my_posts'  %}"> <small>By {{ post.author }} | {{post.published_date}} </small>
<hr>
{% empty %}
<p>No posts yet.</p>
    {% endfor %}-->

 <!-- Posts Section -->
    <div class="row g-4">
        {% for post in posts %}
        <div class="col-md-3">
            <div class="card h-100 shadow-sm">
                <a href="{% url 'blog:post_detail' pk=post.pk %}">
                {% if post.image %}
                    <img style="width: 361px; height: 400px;" src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title }}">
                {% else %}
                    <img style="width: 361px; height: 400px;" src="{% static 'images/default_pic.png' %}" class="card-img-top" alt="Default Image">
                {% endif %}</a>
                <div class="card-body">
                    <h5 class="card-title fw-bold text-primary"><a style="color: black;" href="{% url 'blog:post_detail' pk=post.pk %}">{{ post.title }}</a></h5>
                    <p class="card-text"><a style= "text-decoration:none; color:black" href="{% url 'blog:post_detail' pk=post.pk %}">{{ post.text|truncatewords:20 }}</a></p>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">By {{ post.author }}</small>
                        <a href="{% url 'blog:post_detail' pk=post.pk %}" class="btn btn-sm btn-outline-primary">Read More</a>
                    </div>
                </div>
                <div class="card-footer">
                    <span class="badge bg-secondary">ðŸ“… {{ post.created_date|date:"M d, Y" }}</span>
                    {% if post.category %}
                        <span class="badge bg-secondary ">{{ post.category.name }}</span>
                        {% endif %}
                    {% for tag in post.tags.all %}
                        <span class="badge bg-info text-dark">#{{ tag.name }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% empty %}
        <p>No posts found.</p>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-center mt-4">
        {% if is_paginated %}
            <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
                {% endif %}
                <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>
                {% if page_obj.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
                {% endif %}
            </ul>
        {% endif %}
    </div>

</div>

{% endblock %} 